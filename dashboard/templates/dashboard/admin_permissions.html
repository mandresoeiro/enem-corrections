{% extends "dashboard/base.html" %}
{% block title %}Permissões — ENEM Corrections{% endblock %}
{% block header %}Sistema de Permissões{% endblock %}

{% block content %}

<!-- ===== DESCRIÇÃO ===== -->
<div class="mb-8">
  <p class="text-gray-600 dark:text-gray-400 max-w-2xl">
    Configure o que cada papel (Aluno, Professor, Admin) pode fazer dentro do sistema.
    Essas permissões controlam acesso a páginas, botões, funcionalidades e rotas específicas.
  </p>
</div>

<!-- ===== TABELA DE PERMISSÕES ===== -->
<div class="bg-white dark:bg-gray-800 rounded-xl shadow border border-gray-200 dark:border-gray-700 overflow-hidden">

  <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">

    <!-- HEAD -->
    <thead class="bg-gray-50 dark:bg-gray-700/50">
      <tr>
        <th class="px-6 py-3 text-left text-xs font-bold text-gray-700 dark:text-gray-300 uppercase">Permissão</th>
        <th class="px-6 py-3 text-center text-xs font-bold text-gray-700 dark:text-gray-300 uppercase">Aluno</th>
        <th class="px-6 py-3 text-center text-xs font-bold text-gray-700 dark:text-gray-300 uppercase">Professor</th>
        <th class="px-6 py-3 text-center text-xs font-bold text-gray-700 dark:text-gray-300 uppercase">Admin</th>
      </tr>
    </thead>

    <tbody class="divide-y divide-gray-200 dark:divide-gray-700 bg-white dark:bg-gray-800">

      {% for perm in permissions_list %}

      <tr class="hover:bg-gray-50 dark:hover:bg-gray-700/40 transition">

        <!-- Nome da Permissão -->
        <td class="px-6 py-4">
          <div class="font-medium text-gray-900 dark:text-gray-100">{{ perm.label }}</div>
          {% if perm.description %}
          <small class="text-gray-500 dark:text-gray-400">{{ perm.description }}</small>
          {% endif %}
        </td>

        <!-- Switch Aluno -->
        <td class="px-6 py-4 text-center">
          <form method="POST" action="/admin/permissions/update/">
            {% csrf_token %}
            <input type="hidden" name="role" value="student">
            <input type="hidden" name="permission" value="{{ perm.key }}">
            <button type="submit" class="{% if perm.student %}bg-emerald-600{% else %}bg-gray-300 dark:bg-gray-600{% endif %}
                     w-12 h-6 rounded-full relative transition-all">

              <span class="{% if perm.student %}translate-x-6{% else %}translate-x-0{% endif %}
                       absolute top-0.5 left-0.5 w-5 h-5 bg-white rounded-full shadow transition-all">
              </span>

            </button>
          </form>
        </td>

        <!-- Switch Professor -->
        <td class="px-6 py-4 text-center">
          <form method="POST" action="/admin/permissions/update/">
            {% csrf_token %}
            <input type="hidden" name="role" value="teacher">
            <input type="hidden" name="permission" value="{{ perm.key }}">
            <button type="submit" class="{% if perm.teacher %}bg-emerald-600{% else %}bg-gray-300 dark:bg-gray-600{% endif %}
                     w-12 h-6 rounded-full relative transition-all">

              <span class="{% if perm.teacher %}translate-x-6{% else %}translate-x-0{% endif %}
                       absolute top-0.5 left-0.5 w-5 h-5 bg-white rounded-full shadow transition-all">
              </span>

            </button>
          </form>
        </td>

        <!-- Switch Admin -->
        <td class="px-6 py-4 text-center">
          <form method="POST" action="/admin/permissions/update/">
            {% csrf_token %}
            <input type="hidden" name="role" value="admin">
            <input type="hidden" name="permission" value="{{ perm.key }}">
            <button type="submit" class="{% if perm.admin %}bg-emerald-600{% else %}bg-gray-300 dark:bg-gray-600{% endif %}
                     w-12 h-6 rounded-full relative transition-all">

              <span class="{% if perm.admin %}translate-x-6{% else %}translate-x-0{% endif %}
                       absolute top-0.5 left-0.5 w-5 h-5 bg-white rounded-full shadow transition-all">
              </span>

            </button>
          </form>
        </td>

      </tr>

      {% endfor %}

    </tbody>

  </table>
</div>

{% endblock %}